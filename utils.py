import hashlib

import redis
import config

r = redis.StrictRedis.from_url(config.redis_server)


def store_file(data):
    """
    Store the data in a database returing it's MD5 checksum as a reference
    """
    md5 = hashlib.md5(data).hexdigest()
    key = "file-" + md5
    r.setnx(key, data)
    return md5


def get_file(md5):
    return r.get("file-"+md5)


def format_operations(operations):
    """
    Format a sequence of operations to the human readable string to be displayed in the interface
    """
    msgList = ["{}(0x{:02X}) key change: {:+}".format(*f) for f in operations]
    msg = " ->".join(msgList)
    return msg
